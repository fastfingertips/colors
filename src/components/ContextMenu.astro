---
---

<div id="context-menu" class="context-menu">
  <div class="menu-header">
    <div class="menu-color-preview"></div>
    <div class="menu-info">
      <span class="menu-color-name">Color Name</span>
      <span class="menu-color-hex">#000000</span>
    </div>
  </div>
  <div class="menu-separator"></div>
  <button data-format="hex">
    <span>HEX</span>
    <span class="value-preview">#000000</span>
  </button>
  <button data-format="rgb">
    <span>RGB</span>
    <span class="value-preview">rgb(0,0,0)</span>
  </button>
  <button data-format="hsl">
    <span>HSL</span>
    <span class="value-preview">hsl(0,0%,0%)</span>
  </button>
  <div class="menu-separator"></div>
  <button data-format="css">Copy CSS Variable</button>
</div>

<script>
  const contextMenu = document.getElementById('context-menu') as HTMLElement;
  const menuPreviewColor = contextMenu?.querySelector('.menu-color-preview') as HTMLElement;
  const menuColorName = contextMenu?.querySelector('.menu-color-name') as HTMLElement;
  const menuColorHex = contextMenu?.querySelector('.menu-color-hex') as HTMLElement;
  const menuHexVal = contextMenu?.querySelector('button[data-format="hex"] .value-preview') as HTMLElement;
  const menuRgbVal = contextMenu?.querySelector('button[data-format="rgb"] .value-preview') as HTMLElement;
  const menuHslVal = contextMenu?.querySelector('button[data-format="hsl"] .value-preview') as HTMLElement;
  const copyMsg = document.getElementById('copy-message') as HTMLElement;

  let lastRightClickedColor: string = '';

  function hexToRgb(hex: string): string {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return `rgb(${r}, ${g}, ${b})`;
  }

  function hexToHsl(hex: string): string {
    let r = parseInt(hex.slice(1, 3), 16) / 255;
    let g = parseInt(hex.slice(3, 5), 16) / 255;
    let b = parseInt(hex.slice(5, 7), 16) / 255;

    const max = Math.max(r, g, b), min = Math.min(r, g, b);
    let h = 0, s, l = (max + min) / 2;

    if (max === min) {
      h = s = 0; // achromatic
    } else {
      const d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }

    return `hsl(${Math.round(h * 360)}, ${Math.round(s * 100)}%, ${Math.round(l * 100)}%)`;
  }

  function showCopyMessage(text: string) {
    if (copyMsg) {
      copyMsg.innerText = text;
      copyMsg.classList.add('show');
      setTimeout(() => {
        copyMsg.innerText = 'Copied to clipboard!';
        copyMsg.classList.remove('show');
      }, 2500);
    }
  }

  if (contextMenu) {
    document.addEventListener('contextmenu', (e) => {
      const target = e.target as HTMLElement;
      const colorBox = target.closest('.color-box') as HTMLElement;

      if (colorBox) {
        e.preventDefault();
        const hex = colorBox.getAttribute('data-hex') || '';
        const name = colorBox.querySelector('.color-name')?.textContent || 'Color';

        if (!hex) return;

        lastRightClickedColor = hex;

        if (menuPreviewColor) menuPreviewColor.style.backgroundColor = hex;
        if (menuColorName) menuColorName.textContent = name;
        if (menuColorHex) menuColorHex.textContent = hex;

        if (menuHexVal) menuHexVal.textContent = hex;
        if (menuRgbVal) menuRgbVal.textContent = hexToRgb(hex);
        if (menuHslVal) menuHslVal.textContent = hexToHsl(hex).replace(/\s+/g, '');

        const { clientX: mouseX, clientY: mouseY } = e;
        
        const menuWidth = 200; 
        const menuHeight = 250; 
        let top = mouseY;
        let left = mouseX;

        if (left + menuWidth > window.innerWidth) left = window.innerWidth - menuWidth - 20;
        if (top + menuHeight > window.innerHeight) top = window.innerHeight - menuHeight - 20;

        contextMenu.style.top = `${top}px`;
        contextMenu.style.left = `${left}px`;
        contextMenu.classList.add('open');
      } else {
        contextMenu.classList.remove('open');
      }
    });

    document.addEventListener('click', () => {
      if (contextMenu.classList.contains('open')) {
        contextMenu.classList.remove('open');
      }
    });

    contextMenu.addEventListener('click', (e) => {
      const btn = (e.target as HTMLElement).closest('button');
      if (!btn || !lastRightClickedColor) return;

      const format = btn.getAttribute('data-format');
      let textToCopy = lastRightClickedColor;

      if (format === 'rgb') {
        textToCopy = hexToRgb(lastRightClickedColor);
      } else if (format === 'hsl') {
        textToCopy = hexToHsl(lastRightClickedColor);
      } else if (format === 'css') {
        textToCopy = `var(--color-${lastRightClickedColor.substring(1)})`;
      }

      navigator.clipboard.writeText(textToCopy).then(() => {
        showCopyMessage(`Copied ${format?.toUpperCase()}!`);
      });
    });
  }
</script>
